<!-- ****************************************
     |docname| - main template for this theme
     **************************************** -->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>11.5. Allocators &#8212; CISC 187 Course Reader Overview</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/matrixeq.css?v=58BC228F" />
    <link rel="stylesheet" type="text/css" href="../_static/CodeChat.css" />
    <link rel="stylesheet" type="text/css" href="../_static/webgldemo.css?v=B36B48D" />
    <link rel="stylesheet" type="text/css" href="../_static/webglinteractive.css?v=910DF1E1" />
    <link rel="stylesheet" type="text/css" href="../_static/accessibility.css?v=50109A2C" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/637.0fa6cababf056764.css?v=F9484CEF" />
    <link rel="stylesheet" type="text/css" href="../_static/runestone.3eb60bc006ae9a54.css?v=3A5A250C" />



    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/matrixeq.js?v=D64CFA5A"></script>
    <script src="../_static/animationbase.js?v=A043C3A7"></script>
    <script src="../_static/html4css1.css?v=4533ACD3"></script>
    <script src="../_static/webglinteractive.js?v=2B768384"></script>
    <script src="../_static/FileSaver.min.js?v=8408C997"></script>
    <script src="../_static/runtime.66b619f51b746382.bundle.js?v=C3F69EE5"></script>
    <script src="../_static/637.d54be67956c5c660.bundle.js?v=915B1670"></script>
    <script src="../_static/runestone.ecc6dff5cad8b815.bundle.js?v=AE959292"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://media.ethicalads.io/media/client/ethicalads.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="11.6. constexpr classes" href="constexpr-classes.html" />
    <link rel="prev" title="11.4. Moving memory" href="move.html" />


<link rel="shortcut icon" href="/cisc187-reader/static/favicon.ico" type="image/ico" />



<link rel="canonical" href="https://{{canonical_host}}{{new_server_prefix}}/books/published/{{base_course}}/{{pagepath}}" />


<script>
  eBookConfig = {};
  
    eBookConfig.useRunestoneServices = false;
    eBookConfig.host = 'https://daveparillo.github.io/cisc187-reader/' || 'http://127.0.0.1:8000';
    eBookConfig.app = eBookConfig.host+'/cisc187-reader';
    eBookConfig.course = 'cisc187-reader';
    eBookConfig.basecourse = 'cisc187-reader';
    eBookConfig.isLoggedIn = false;
    eBookConfig.enableCompareMe = eBookConfig.useRunestoneServices;
    eBookConfig.new_server_prefix = '';
  
  eBookConfig.ajaxURL = eBookConfig.app+'/ajax/';
  eBookConfig.logLevel = 0;
  eBookConfig.loginRequired = false;
  eBookConfig.build_info = "unknown";
  eBookConfig.python3 = true;
  eBookConfig.acDefaultLanguage = 'cpp' ? 'cpp' : 'python'
  eBookConfig.runestone_version = '6.6.2';
  eBookConfig.jobehost = 'https://red-voice-1370.fly.dev/http://jobe2.cosc.canterbury.ac.nz';
  eBookConfig.proxyuri_runs = '/jobe/index.php/restapi/runs/';
  eBookConfig.proxyuri_files = '/jobe/index.php/restapi/files/';
  eBookConfig.enable_chatcodes = false ? false : false;
  eBookConfig.enableScratchAC = true;

</script>

<!-- Ad Serving Headers Only serve ads to Anonymous Users -->



  </head><body>


<!-- Begin navbar -->
<div id="navbar" class="navbar navbar-default navbar-fixed-top" role="navigation">

  <div class="container">

    <div class="navbar-header">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button type='button' class='navbar-toggle' data-toggle="collapse" data-target=".navbar-ex1-collapse" aria-label="navbar toggle">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div>
        
        
          <div class="brand-logo"><img src="../_static/img/RAIcon.png" alt=""></div>
        
        <a class="navbar-brand" href="../index.html" aria-label="index-page">
          
          cisc187-reader
        </a>
      </div>
    </div>



    <div class="navbar-collapse collapse navbar-ex1-collapse">
      <ul class="nav navbar-nav navbar-right" >

        <li class="divider-vertical"></li>
        <li><span id="ad_warning"></span></li>
        <li><span id="browsing_warning"></span></li>

        <!-- social media dropdown -->
        <!-- end social media dropdown -->

        <li class="divider-vertical"></li>
        <!-- search dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-search" style='opacity:0.9;'><span class="visuallyhidden" aria-label="Search">Search</span></i>
          </a>
          <ul class='dropdown-menu'>
            
                <li><a href='../index.html' aria-label="index-page">Table of Contents</a></li>
            
            <li><a href='../genindex.html'>Book Index</a></li>
            <li class="divider"></li>
            <li style="width: 240px;">
              <form class="navbar-search" style="margin:10px;" action="../search.html" method="get">
                <div class="input-group">
                  <input type="text" class="form-control" name="q" placeholder="Search this book" />
                  <span class="input-group-btn">
                    <button class="btn btn-primary" style="margin:0;" type="submit">
                      <i class="glyphicon glyphicon-search"></i>
                    </button>
                  </span>
                </div><!-- /input-group -->
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
            </li>
          </ul>
        </li>
        <!-- end search dropdown -->

        <li class="divider-vertical"></li>

        
        <li class="divider-vertical"></li>
        <!-- <li id="scratch_ac_link"><a href="javascript:ACFactory.toggleScratchActivecode()">Scratch ActiveCode</a></li> -->

        <!-- <li class="dropdown">             -->
          <li id="scratch_ac_link" class="dropdown"><a href="javascript:runestoneComponents.popupScratchAC()">
              <i class="glyphicon glyphicon-pencil" style="opacity:0.9;"><span class="visuallyhidden" aria-label="Scratch Activecode" >Scratch Activecode</span></i></a></li>
        <!-- </li> -->

        <li class="divider-vertical"></li>

        
      </ul>

      <ul class="nav navbar-nav">
        <li class="divider-vertical"></li>
        
          
          <li class="divider-vertical"></li>
        
        <!-- 
          
  <li id="relations-prev" title="Previous Chapter - <span class="section-number">11.4. </span>Moving memory" data-toggle="tooltip">
    <a href="move.html" >
      <i class='glyphicon glyphicon-backward' style='opacity:0.9;'></i>
    </a>
  </li>
  
  <li id="relations-next" title='Next Chapter - <span class="section-number">11.6. </span><code class="docutils literal notranslate"><span class="pre">constexpr</span></code> classes' data-toggle="tooltip" >              
    <a href="constexpr-classes.html" >
        <i class='glyphicon glyphicon-forward' style='opacity:0.9;'></i>
    </a>
  </li>
  <li class="divider-vertical"></li>

<script>
  opts = {'placement':'bottom',
          'selector': '',
          'delay': { show: 100, hide: 50}
         };

  window.addEventListener('load', (event) => {
    $('#relations-prev').tooltip(opts);
    $('#relations-next').tooltip(opts);
  });
</script>
        -->
        
          <li></li>
        
      </ul>
      </div> <!-- navbar-collapse -->
    </div> <!-- navbar -->
  </div> <!-- container -->


<div class="container" id="continue-reading"></div>

<div class="container" id="main-content" role="main">

<!-- Ad Serving for Runestone Campaign -->


  
  <section id="allocators">
<span id="index-0"></span><h1><span class="section-number">11.5. </span>Allocators<a class="headerlink" href="#allocators" title="Permalink to this heading">¶</a></h1>
<p>Those of you who have been paying attention may have noticed most
containers in the standard library have declarations like:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span>
<span class="w">          </span><span class="k">class</span><span class="w"> </span><span class="nc">Allocator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span>
<span class="k">class</span><span class="w"> </span><span class="nc">vector</span><span class="p">;</span>
</pre></div>
</div>
<p>What is the second template type parameter for?</p>
<p>An <a class="reference external" href="https://en.cppreference.com/w/cpp/memory/allocator">allocator</a> manages the memory of each element stored in
the container. The job of an allocator is similar to what the operators
<a class="reference external" href="https://en.cppreference.com/w/cpp/memory/new">new</a> and <a class="reference external" href="https://en.cppreference.com/w/cpp/memory/new">delete</a> do, but in a more generic an extensible way.
An allocator can allocate and deallocate memory for its elements and
initialize and destroy element memory.
And it can perform each of these actions as separate steps.</p>
<p>Why bother?</p>
<p>Allocators were originally conceived during the initial development of
the standard library when library developers realized that some classes
that took a template parameter of type <code class="docutils literal notranslate"><span class="pre">T</span></code> could break if <code class="docutils literal notranslate"><span class="pre">T</span></code> did
not have a default constructor.
An allocator can create default values for types that don’t have their own
default values.
Similarly, an allocator can ensure memory is destroyed when we are
finished with it.
In short, the original <code class="docutils literal notranslate"><span class="pre">new</span></code> and <code class="docutils literal notranslate"><span class="pre">delete</span></code> operators did not handle
all the cases required for advanced memory management.</p>
<ul>
<li><p>Designers realized the container should be independent of the underlying memory model.
For example, the  Intel Memory Model on x86 architectures use six different variants:</p>
<p>tiny, small, medium, compact, large, and huge.</p>
<p>Allocators allow container users to define exactly the memory allocation scheme
appropriate for their runtime environment.</p>
</li>
<li><p>Containers separate the memory allocation and deallocation from the
initialization and destruction of their elements.</p>
<p>A call to <a class="reference external" href="https://en.cppreference.com/w/cpp/container/vector/reserve">vector::reserve(n)</a>
allocates memory for at least n elements.
The constructor for each element will <strong>not</strong> be called.</p>
</li>
</ul>
<p>We can handle types without a default value by giving users the option
to specify the value to be used when we need a default:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">resize</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">new_capacity</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">default_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">())</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">reserve</span><span class="p">(</span><span class="n">new_capacity</span><span class="p">);</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">fill</span><span class="p">(</span><span class="n">begin</span><span class="p">()</span><span class="o">+</span><span class="n">size_</span><span class="p">,</span><span class="w"> </span><span class="n">begin</span><span class="p">()</span><span class="o">+</span><span class="n">capacity_</span><span class="p">,</span><span class="w"> </span><span class="n">default_value</span><span class="p">);</span>
<span class="w">  </span><span class="n">size_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_capacity</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This form of resize() will use <code class="docutils literal notranslate"><span class="pre">T()</span></code>, unless the user provides an alternative.
For example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">bag</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stuff</span><span class="p">;</span>
<span class="n">stuff</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w">        </span><span class="c1">// add 100 doubles all == 0.0</span>
<span class="n">stuff</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mf">3.14</span><span class="p">);</span><span class="w">  </span><span class="c1">// add 200 copies of 3.14</span>
<span class="n">stuff</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span><span class="w">   </span><span class="c1">// add 200 copies of 0.0 (redundant)</span>
</pre></div>
</div>
<p>The destructor problem is harder to address.
We need to deal with a data structure that may contain a mix of some
initialized data and some uninitialized data.
Typically, we are very careful to avoid uninitialized data and
the associated programming errors.
Now as the developers of generic containers we have to handle this problem
so that users of these containers don’t have to.</p>
<p>First we need a way to get an manipulate uninitialized storage.
<strong>This</strong> is where <a class="reference external" href="https://en.cppreference.com/w/cpp/memory/allocator">allocator</a> comes in.
A simplified allocator looks like this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<span class="w">  </span><span class="k">class</span><span class="w"> </span><span class="nc">allocator</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">value_type</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// other types and constructors omitted</span>

<span class="w">    </span><span class="n">T</span><span class="o">*</span><span class="w">   </span><span class="nf">allocate</span><span class="w">  </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="p">);</span><span class="w">        </span><span class="c1">// allocate space to n objects of T</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">deallocate</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="p">);</span><span class="w">  </span><span class="c1">// deallocate n objects of T</span>
<span class="w">                                           </span><span class="c1">// starting at location p</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">construct</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w">  </span><span class="c1">// construct a value of T in p</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">destroy</span><span class="w">  </span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">);</span><span class="w">                  </span><span class="c1">// destroy the T in p</span>

<span class="w">  </span><span class="p">};</span>
</pre></div>
</div>
<p>These 4 functions provide the core capabilities of an allocator:</p>
<ul class="simple">
<li><p>Allocate memory of a size suitable to hold an object of type <code class="docutils literal notranslate"><span class="pre">T</span></code>
<em>without initializing it</em>.</p></li>
<li><p>Construct an object of type <code class="docutils literal notranslate"><span class="pre">T</span></code> in uninitialized space.</p></li>
<li><p>Destroy an object of type <code class="docutils literal notranslate"><span class="pre">T</span></code> - returning the memory space
to the uninitialized state.</p></li>
<li><p>Deallocate uninitialized memory of size suitable for an object of type <code class="docutils literal notranslate"><span class="pre">T</span></code>.</p></li>
</ul>
<section id="using-std-allocator-traits">
<span id="index-1"></span><h2><span class="section-number">11.5.1. </span>Using std::allocator_traits<a class="headerlink" href="#using-std-allocator-traits" title="Permalink to this heading">¶</a></h2>
<p>An allocator is exactly what a container to separate
memory allocation from object construction and
memory deallocation from object destruction.</p>
<p>How does a container use an allocator?
First, as in the standard library, we need a allocator type parameter
and a local variable to store an instance of the allocator.
Although you can use an allocator directly,
the allocator interfaces are deprecated, and we are going to use
the <a class="reference external" href="https://en.cppreference.com/w/cpp/memory/allocator_traits">allocator_traits</a> interface.
The allocator_traits class template provides the standardized way
to access various properties of Allocators.
The standard containers and other standard library components access
allocators through this template, which makes it possible to use any
class type as an allocator.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Allocator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span>
<span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">bag</span><span class="w"> </span><span class="p">{</span>

<span class="w">   </span><span class="n">Allocator</span><span class="w"> </span><span class="n">allocator_</span><span class="p">;</span>

<span class="w">   </span><span class="c1">// . . .</span>
<span class="w"> </span><span class="p">};</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://en.cppreference.com/w/cpp/memory/allocator_traits">allocator_traits</a> interface consists entirely of static
members - no object instance exists and it is completely stateless,
however the syntax is a bit verbose, which is why I frequently alias it
in a class:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Allocator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span>
<span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">bag</span><span class="w"> </span><span class="p">{</span>

<span class="w">   </span><span class="n">Allocator</span><span class="w"> </span><span class="n">allocator_</span><span class="p">;</span>
<span class="w">   </span><span class="k">using</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">allocator_traits</span><span class="o">&lt;</span><span class="n">Allocator</span><span class="o">&gt;</span><span class="p">;</span>

<span class="w">   </span><span class="c1">// . . .</span>
<span class="w"> </span><span class="p">};</span>
</pre></div>
</div>
<p>Now except for using our allocator object, the class is unchanged.
Container users can ignore the allocator unless they need a <code class="docutils literal notranslate"><span class="pre">bag</span></code>
that manages memory for its elements in some unusual way.</p>
<p>The only class functions that require modification are those that deal
directly with memory:</p>
<ul class="simple">
<li><p>object construction and destruction</p></li>
<li><p>memory allocation and deallocation</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">reserve</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">new_capacity</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// never decrease allocation</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">new_capacity</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">capacity_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="c1">// allocate new space</span>
<span class="w">  </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">new_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">T</span><span class="p">[</span><span class="n">new_capacity</span><span class="p">];</span>

<span class="w">  </span><span class="c1">// copy into new space</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">copy</span><span class="p">(</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">new_data</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// delete old memory</span>
<span class="w">  </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">data_</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// point to the new data</span>
<span class="w">  </span><span class="n">data_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_data</span><span class="p">;</span>
<span class="w">  </span><span class="n">capacity_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_capacity</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Refactoring the original version of <code class="docutils literal notranslate"><span class="pre">reserve</span></code> to use an allocator
involves several steps.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">reserve</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">new_capacity</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// never decrease allocation</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">new_capacity</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">capacity_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// allocate new space</span>
<span class="w">  </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">new_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">memory</span><span class="o">::</span><span class="n">allocate</span><span class="p">(</span><span class="n">allocator_</span><span class="p">,</span><span class="w"> </span><span class="n">new_capacity</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// copy into new space</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">new_capacity</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">memory</span><span class="o">::</span><span class="n">construct</span><span class="p">(</span><span class="n">allocator_</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">new_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">data_</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// delete old memory</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">capacity_</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">memory</span><span class="o">::</span><span class="n">destroy</span><span class="p">(</span><span class="n">allocator_</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">data_</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// deallocate old space</span>
<span class="w">  </span><span class="n">memory</span><span class="o">::</span><span class="n">deallocate</span><span class="p">(</span><span class="n">allocator_</span><span class="p">,</span><span class="w"> </span><span class="n">data_</span><span class="p">,</span><span class="w"> </span><span class="n">capacity_</span><span class="p">);</span>
<span class="w">  </span><span class="n">data_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_data</span><span class="p">;</span>
<span class="w">  </span><span class="n">capacity_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_capacity</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<hr class="docutils" />
<div class="admonition-more-to-explore admonition">
<p class="admonition-title">More to Explore</p>
<ul class="simple">
<li><p>From cppreference.com</p>
<ul>
<li><p>Named requirement <a class="reference external" href="https://en.cppreference.com/w/cpp/named_req/Allocator">Allocator</a></p></li>
<li><p><a class="reference external" href="https://en.cppreference.com/w/cpp/memory/allocator_traits">allocator_traits</a></p></li>
<li><p><a class="reference external" href="https://en.cppreference.com/w/cpp/memory/new">new</a></p></li>
</ul>
</li>
<li><p>Writing allocators</p>
<ul>
<li><p><a class="reference external" href="https://www.modernescpp.com/index.php/memory-management-with-std-allocator">Memory Management with std::allocator</a></p></li>
<li><p><a class="reference external" href="https://howardhinnant.github.io/allocator_boilerplate.html">Allocator Boilerplate</a></p></li>
</ul>
</li>
</ul>
</div>
</section>
</section>


  

  <div id="scprogresscontainer">
    You have attempted <span id="scprogresstotal"></span> of <span id="scprogressposs"></span> activities on this page <div id="subchapterprogress" aria-label="Page progress"></div>
  </div>

  <ul role="navigation" class="nextprev-list nextprev-list" aria-label="Change page">
<li id="relations-prev" class="navLink" title='Previous Section - 11.4. Moving memory' data-toggle="tooltip">
  <a href="move.html" aria-label="Previous - 11.4. Moving memory">
    <i class='prevNav glyphicon glyphicon-chevron-left'  style="top:50%; transform:translateY(-50%)translateX(-50%); left: 50%; color:black;"></i>
  </a>
</li>

  <li id="relations-next" class="navLink" title='Next Section - 11.6.  constexpr  classes' data-toggle="tooltip" >
    <a href="constexpr-classes.html" aria-label="Next - 11.6.  constexpr  classes">
      <i id="relationsNextIcon" class='nextNav glyphicon glyphicon-chevron-right' style="top:50%; transform:translateY(-50%)translateX(-50%); left: 50%; color:black; "></i>
    </a>
  </li>
</ul>

<script>
window.addEventListener('load', (event) => {
  $('#relations-prev').tooltip({'placement': 'right', 'delay': { show: 100, hide: 50}});
  $('#relations-next').tooltip({'placement': 'left', 'delay': { show: 100, hide: 50}});
});
</script>

</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      
      | <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017-2023 Dave Parillo.
      Created using <a href="http://runestoneinteractive.org/">Runestone</a> 6.6.2.
    </p>
  </div>
</footer>




<script>
  window.addEventListener('load', (event) => {
    runestoneComponents.getSwitch();
  });
</script>


  </body>
</html>